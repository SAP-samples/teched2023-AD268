'use strict';

var format = require('util').format;
var utils = require('../utils');
var MANDATORY_OPTIONS = require('./constants').MANDATORY_OPTIONS;
var MANDATORY_OR_OPTIONS = require('./constants').MANDATORY_OR_OPTIONS;
var DEFAULT_SERVICE = require('./constants').DEFAULT_SERVICE;
var DEFAULT_PLAN = require('./constants').DEFAULT_PLAN;
var DEFAULT_ALLOW_BINDING = require('./constants').DEFAULT_ALLOW_BINDING;

module.exports = {
  processMainOptions: processMainOptions
};

function processMainOptions(options) {
  MANDATORY_OPTIONS.forEach(function (property) {
    if (!utils.isNonEmptyString(options[property])) {
      throw new Error(format("Property '%s' should be a non-empty string", property));
    }
  });

  ['service', 'plan'].forEach(function (property) {
    if (utils.isDefined(options[property]) && !utils.isNonEmptyString(options[property])) {
      throw new Error(format("Property '%s' should be a non-empty string if provided", property));
    }
  });

  if (!MANDATORY_OR_OPTIONS.some((property) => options[property])) {
    throw new Error(format("One of listed properties: '%s' should be a non-empty string", MANDATORY_OR_OPTIONS.join(', ')));
  }

  options.service = options.service || DEFAULT_SERVICE;
  options.plan = options.plan || DEFAULT_PLAN;
  options.allowBinding = (options.allowBinding !== undefined) ? options.allowBinding : DEFAULT_ALLOW_BINDING;
  return options;
}
