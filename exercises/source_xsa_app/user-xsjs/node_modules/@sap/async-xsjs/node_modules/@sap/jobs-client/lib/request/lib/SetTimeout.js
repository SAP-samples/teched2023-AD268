// See https://nodejs.org/api/timers.html#timers_class_timeout
const MAX_NODE_TIMEOUT_VALUE = 2147483647;

class SetTimeout {

    constructor(callback, timeout) {
        this._callback = callback;
        this._timeout = timeout;
        this._maxTimeout = MAX_NODE_TIMEOUT_VALUE;
    }

    stop() {
        if (this._timer) clearTimeout(this._timer);
    }

    start(...args) {

        let nextTimeout;
        if (this._timeout > this._maxTimeout) {
            nextTimeout = this._maxTimeout;
            this._timeout -= this._maxTimeout;
        } else {
            nextTimeout = this._timeout;
            this._timeout = null;
        }
        this._timer = setTimeout((..._args) => {
            if (this._timeout === null) {
                this._callback(..._args);
            } else {
                this.start(..._args);
            }
        }, nextTimeout, ...args).unref();
        return this;
    }

}

module.exports = SetTimeout;