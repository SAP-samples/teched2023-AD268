const OAuthRequest = require('./OAuthRequest');

/* BasicAuthRequest extends Request

Executing basic auth based http(s) requests.

```js
const BasicAuthRequest = require('@sap/cf-scheduler-utils').BasicAuthRequest;

const options = {
   url: 'https://any-url.tld/path?any=queryString',
   basic: {
    user:'...',
    password:'...'
   }
}

try{
    const response = await new BasicAuthRequest(options).execute();
} catch(error){
    // handle error;
    if(error.response){
        // log response data
    }
}
``` */
class BasicAuthRequest extends OAuthRequest {


    /**
     * Executes a basic auth request.
     *
    * @param  {object} options - The request options. See Request
    * @param  {string} [options.basic] - Providing authentication mechanim
    * @param  {string} [options.basic.user] - Provides the plain user for basic auth
    * @param  {string} [options.basic.password] - The plain password for basic auth
    * @see Request
    */
    constructor(options, expectedStatusCodes) {

        super(options, expectedStatusCodes);

        if (options.basic) {
            this._setAuthorizationBasicHeader(options.basic);
        }
    }

    _setAuthorizationBasicHeader(basicAuth) {
        if (!basicAuth) return this;
        const options = this.getOptions();
        if (!options.headers) options.headers = {};
        options.auth = `${basicAuth.user || basicAuth.username}:${basicAuth.password || basicAuth.pass || basicAuth.passwd}`;
        return this;
    }

}

module.exports = BasicAuthRequest;

