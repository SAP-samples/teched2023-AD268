'use strict';

var dbStream = require('@sap/hana-client/extension/Stream');

module.exports = fetchRowsPromise;

function fetchRowsPromise (resultSet, streamType) {
  return new Promise ((resolve, reject) => {
    var rows = [];

    var stream = (streamType === 'array') ?
      dbStream.createArrayStream(resultSet) :
      dbStream.createObjectStream(resultSet);

    stream.on('readable', function () {
      var data;
      while ((data = stream.read()) !== null) {
        rows.push(data);
      }
    });

    stream.once('error', function (err) {
      stream.removeAllListeners();
      reject(err);
    });

    stream.on('end', function () {
      stream.removeAllListeners();
      resolve(rows);
    });
  });
}