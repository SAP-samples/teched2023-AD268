'use strict';

const requests = require('../requests');

class XsuaaService {
    #jku;
    #zid;           // optional zone id

    get jku() { return this.#jku; }
    get zid() { return this.#zid; }

    constructor(jku, zid) {
        if(jku === undefined) {
            throw new Error("XsuaaService requires a jku to fetch JWKS from.");
        }

        this.#jku = jku;
        this.#zid = zid;
    }

    async fetchJwks() {
        return new Promise((res, rej) => {
            try {
                requests.fetchKeyFromXSUAA(this.jku, this.zid, null, function (err, json) {
                    if (err) {
                        return rej(err);
                    }

                    return res(json.keys);
                });
            } catch (e) {
                return rej(e);
            }
        });
    }

    toJSON() {
        return {
            ...this,
            jku: this.jku,
            zid: this.zid
        }
    }
}

module.exports = XsuaaService;
